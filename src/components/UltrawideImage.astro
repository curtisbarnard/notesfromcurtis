---
// This component is meant for 16:9 or wider aspect ratio images. It generates responsive sizes at build time using Astro's built-in optimization.
// Import images from src/assets/images/ and pass them as props.
// Astro will automatically generate responsive sizes and formats.
// On mobile, the image maintains a calculated height and crops the edges to prevent ultrawide images from becoming too small.

import type { ImageMetadata } from 'astro';
import { Picture } from 'astro:assets';

interface Props {
  img: ImageMetadata;
  altText: string;
  caption?: string;
}

const { img, altText, caption } = Astro.props;

// Calculate mobile height from image aspect ratio
// We calculate what height would be at that the targetMobileWidth, then ensure a minimum for visibility
const aspectRatio = img.width / img.height;
const targetMobileWidth = 500;
const calculatedHeight = targetMobileWidth / aspectRatio;
const mobileHeightPx = `${calculatedHeight}px`;
---

<figure>
  <Picture
    src={img}
    alt={altText}
    widths={[600, 800, 1000, 1200]}
    formats={['webp', 'avif']}
    sizes="(max-width: 1000px) 100vw, 1000px"
    loading="lazy"
  />
  { caption && <figcaption>{caption}</figcaption> }
</figure>

<style define:vars={{ mobileHeight: mobileHeightPx }}>
  figure {
    text-align: left;
    margin: 1rem 0 1rem 0;
  }

  picture {
    display: block;
    width: 100%;
  }

  img {
    width: 100%;
    max-width: 100%;
    height: auto;
    display: block;
    box-shadow:
      0 3px 12px hsla(0, 0%, 0%, 0.05),
      0 3px 6px hsla(0, 0%, 0%, 0.05);
  }

  figcaption {
    font-size: 0.8rem;
    color: hsl(31, 30%, 20%);
    border-left: 3px solid hsl(31, 30%, 20%);
    padding-left: 0.5rem;
    margin-top: 0.5rem;
  }

  @media (min-width: 1000px) {
    figure {
      width: 1000px;
      margin-left: 50%;
      transform: translateX(-50%);
    }
  }

  @media (max-width: 1000px) {
    figure {
      width: 100%;
      margin: 0;
    }

    img {
      width: 100%;
      height: var(--mobileHeight);
      min-height: var(--mobileHeight);
      object-fit: cover;
      object-position: center;
    }
  }
</style>
